<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lazy Eye Therapy ‚Äì Doctor Grade</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #020617;
    font-family: Arial, sans-serif;
    overflow: hidden;
    user-select: none;
}

body { -webkit-touch-callout: none; }

/* ---------- HOME ---------- */
#menu {
    height: 100vh;
    text-align: center;
    padding: 30px;
    background: radial-gradient(circle, #0f172a, #020617);
    color: white;
}

button, select {
    font-size: 18px;
    padding: 12px 18px;
    margin: 8px;
    border-radius: 12px;
    border: none;
}

.eye-btn {
    background: #1e293b;
    color: white;
}
.eye-btn.active {
    background: #22c55e;
    color: black;
}

/* ---------- THERAPY ---------- */
#therapy {
    display: none;
    width: 100vw;
    height: 100vh;
    background: black;
}

.half {
    position: absolute;
    width: 50vw;
    height: 100vh;
    overflow: hidden;
}

#left { left: 0; }
#right { right: 0; }

#object {
    position: absolute;
    width: 36px;
    height: 36px;
    transform-origin: center center;
    will-change: transform, left, top;
}

/* ---------- SUBTLE CLOSE BUTTON ---------- */
#closeBtn {
    position: fixed;
    top: 10px;
    right: 12px;
    font-size: 20px;
    color: rgba(200,200,200,0.55); /* soft grey */
    background: transparent;
    border: none;
    z-index: 999;
    cursor: pointer;
}

/* ---------- POPUP ---------- */
#popup {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.92);
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    color: white;
    text-align: center;
    padding: 20px;
}

#fullscreenPopupBtn {
    background: #22c55e;
    color: black;
    font-size: 20px;
    padding: 14px 22px;
    border-radius: 14px;
    margin-top: 16px;
}

#count {
    margin-top: 16px;
    font-size: 22px;
}
</style>
</head>

<body oncontextmenu="return false">

<!-- HOME -->
<div id="menu">
<h2>üëÅÔ∏è Lazy Eye Visual Therapy</h2>
<p style="color:#fde68a">Consult an Eye Specialist to identify the lazy eye</p>

<button class="eye-btn" id="btnLeft" onclick="selectEye('left')">Left Eye</button>
<button class="eye-btn" id="btnRight" onclick="selectEye('right')">Right Eye</button>

<br><br>

<select id="mode">
<option value="random">Random</option>
<option value="white">White Dancing Ball</option>
<option value="color">Colourful Dancing Ball</option>
<option value="shape">Dancing Shapes</option>
<option value="line">Dancing Lines</option>
<option value="fruit">Dancing Fruits</option>
<option value="flower">Dancing Flowers</option>
</select>

<br><br>
<button onclick="showPopup()">Start Therapy</button>
</div>

<!-- POPUP -->
<div id="popup">
<p>
Step 1: Click <b>Enter Fullscreen</b><br>
Step 2: Rotate phone to <b>Landscape</b><br>
Step 3: Place phone in <b>VR Headset</b>
</p>

<button id="fullscreenPopupBtn" onclick="enterFullscreenAndStart(this)">
Enter Fullscreen
</button>

<div id="count"></div>
</div>

<!-- THERAPY -->
<div id="therapy">
<button id="closeBtn" onclick="exitTherapy()">‚úï</button>
<div id="left" class="half"></div>
<div id="right" class="half"></div>
</div>

<audio id="bgm" loop>
<source src="https://cdn.pixabay.com/audio/2022/10/25/audio_9467a82fa0.mp3">
</audio>

<script>
let eye = "left";
let area, obj;
let t = 0;
let currentRotation = 0;

/* Data */
const colors = ["red","blue","green","yellow","orange","pink","brown"];
const shapes = ["circle","square","rectangle","triangle","oval"];
const fruits = ["üçé","üçå","üçä","üçâ","üçì"];
const flowers = ["üå∏","üåº","üåª","üåπ"];

/* Speech */
const speech = new SpeechSynthesisUtterance();
speech.rate = 0.7;
speech.pitch = 1.4;

/* Eye */
function selectEye(e){
    eye = e;
    document.querySelectorAll(".eye-btn").forEach(b=>b.classList.remove("active"));
    document.getElementById(e==="left"?"btnLeft":"btnRight").classList.add("active");
}

/* Popup */
function showPopup(){
    document.getElementById("popup").style.display="flex";
}

/* Fullscreen */
async function enterFullscreenAndStart(btn){
    btn.style.display="none";

    try{
        speech.text = "Let's begin";
        speechSynthesis.speak(speech);

        document.getElementById("bgm").volume = 0.12;
        document.getElementById("bgm").play();
    }catch(e){}

    try{
        await document.documentElement.requestFullscreen();
        if(screen.orientation?.lock){
            await screen.orientation.lock("landscape");
        }
    }catch(e){}

    let c = 10;
    const count = document.getElementById("count");
    count.innerText = "Starting in " + c;

    const timer = setInterval(()=>{
        c--;
        count.innerText = "Starting in " + c;
        if(c < 0){
            clearInterval(timer);
            document.getElementById("popup").style.display="none";
            launch();
        }
    },1000);
}

/* Launch */
function launch(){
    document.getElementById("menu").style.display="none";
    document.getElementById("therapy").style.display="block";

    area = document.getElementById(eye);
    obj = document.createElement("div");
    obj.id="object";
    area.appendChild(obj);

    updateVisual();
    setInterval(updateVisual,5000);
    animate();
}

/* Exit */
function exitTherapy(){
    location.reload();
}

/* Motion + Depth */
function animate(){
    if(!obj || !area) return;

    const rect = area.getBoundingClientRect();
    const marginX = rect.width * 0.15;
    const marginY = rect.height * 0.18;

    t += 0.006;

    const xPos = marginX + (Math.sin(t)+1)/2 * (rect.width-2*marginX);
    const yPos = marginY + (Math.sin(t*0.9)+1)/2 * (rect.height-2*marginY);

    const scale = 0.65 + (Math.sin(t)+1)/2 * 0.7;

    obj.style.left = xPos+"px";
    obj.style.top  = yPos+"px";
    obj.style.transform = `scale(${scale}) rotate(${currentRotation}deg)`;

    requestAnimationFrame(animate);
}

/* Visual */
function updateVisual(){
    let mode = document.getElementById("mode").value;
    if(mode==="random"){
        mode = ["white","color","shape","line","fruit","flower"][Math.floor(Math.random()*6)];
    }

    obj.innerHTML="";
    obj.style.background="";
    obj.style.border="none";
    obj.style.borderRadius="0";
    obj.style.fontSize="";
    currentRotation = 0;

    if(mode==="white"){
        obj.style.width="36px";
        obj.style.height="36px";
        obj.style.background="white";
        obj.style.borderRadius="50%";
        return;
    }

    const color = colors[Math.floor(Math.random()*colors.length)];

    if(mode==="color"){
        speak("Can you tell me the colour?");
        obj.style.width="36px";
        obj.style.height="36px";
        obj.style.background=color;
        obj.style.borderRadius="50%";
    }

    if(mode==="shape"){
        speak("Can you tell me the shape?");
        const s = shapes[Math.floor(Math.random()*shapes.length)];
        obj.style.background=color;
        obj.style.width="42px";
        obj.style.height="42px";

        if(s==="circle") obj.style.borderRadius="50%";
        if(s==="square") obj.style.borderRadius="0";
        if(s==="rectangle") obj.style.width="62px";
        if(s==="triangle"){
            obj.style.background="transparent";
            obj.style.borderLeft="21px solid transparent";
            obj.style.borderRight="21px solid transparent";
            obj.style.borderBottom="42px solid "+color;
        }
    }

    if(mode==="line"){
        speak("Can you tell me the line?");
        obj.style.width="4px";
        obj.style.height="62px";
        obj.style.background=color;
        currentRotation = [0,90,30,-30][Math.floor(Math.random()*4)];
    }

    if(mode==="fruit"){
        speak("Which fruit is this?");
        obj.style.fontSize="42px";
        obj.innerHTML = fruits[Math.floor(Math.random()*fruits.length)];
    }

    if(mode==="flower"){
        speak("Which flower is this?");
        obj.style.fontSize="42px";
        obj.innerHTML = flowers[Math.floor(Math.random()*flowers.length)];
    }
}

/* Speak */
function speak(text){
    speech.text = text;
    speechSynthesis.cancel();
    speechSynthesis.speak(speech);
}
</script>

</body>
</html>
