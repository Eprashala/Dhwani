<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Voice Console Pro</title>
    <style>
        :root {
            --bg-color: #000000;
            --term-green: #00ff41;
            --term-dim: #008F11;
            --ui-border: #333;
            --header-height: 120px;
            --footer-height: 70px;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--term-green);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }

        /* --- HEADER --- */
        #controls {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: #111;
            border-bottom: 1px solid var(--ui-border);
            padding: 10px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* Top Row: Dropdown + Install Link */
        .voice-row {
            display: flex;
            gap: 5px;
        }

        select {
            flex: 1;
            background: #000;
            color: var(--term-green);
            border: 1px solid var(--term-dim);
            padding: 8px;
            font-size: 16px;
            border-radius: 4px;
            outline: none;
        }

        #btn-install {
            background: #222;
            color: #aaa;
            border: 1px solid #444;
            padding: 0 10px;
            border-radius: 4px;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        /* Bottom Row: Controls */
        .btn-group {
            display: flex;
            gap: 5px;
            height: 45px;
        }

        button {
            flex: 1;
            background: #222;
            border: 1px solid var(--term-dim);
            color: white;
            border-radius: 4px;
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
        }

        button:active { background: var(--term-dim); }

        /* --- CONSOLE OUTPUT --- */
        #console-output {
            position: absolute;
            top: var(--header-height);
            bottom: var(--footer-height);
            left: 0;
            right: 0;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .log-entry {
            font-size: 1.1rem;
            line-height: 1.5;
            padding: 10px;
            border-left: 2px solid #333;
            color: #ccc; /* Default dim color */
            transition: all 0.3s;
        }

        /* Highlight style when reading */
        .log-entry.active-reading {
            color: var(--term-green);
            border-left: 4px solid var(--term-green);
            background: rgba(0, 255, 65, 0.05);
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 255, 65, 0.5);
        }

        /* --- FOOTER INPUT --- */
        #input-area {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--footer-height);
            background: #111;
            border-top: 1px solid var(--ui-border);
            padding: 10px;
            z-index: 100;
        }

        #command-input {
            width: 100%;
            height: 100%;
            background: #000;
            border: 1px solid var(--term-dim);
            color: white;
            padding: 10px;
            font-size: 16px;
            border-radius: 4px;
            outline: none;
        }

        #command-input:focus { box-shadow: 0 0 5px var(--term-dim); }

    </style>
</head>
<body>

    <div id="controls">
        <div class="voice-row">
            <select id="voice-select"><option value="-1">Loading...</option></select>
            <a id="btn-install" href="https://play.google.com/store/apps/details?id=com.google.android.tts" target="_blank">Install Voices</a>
        </div>
        
        <div class="btn-group">
            <button id="btn-play">▶ Play</button>
            <button id="btn-pause">⏸ Pause</button>
            <button id="btn-stop">⏹ Stop</button>
        </div>
    </div>

    <div id="console-output">
        </div>

    <div id="input-area">
        <input type="text" id="command-input" placeholder="Type text here..." autocomplete="off">
    </div>

<script>
    const synth = window.speechSynthesis;
    const voiceSelect = document.getElementById('voice-select');
    const inputField = document.getElementById('command-input');
    const outputDiv = document.getElementById('console-output');
    
    let voices = [];
    let lastText = "";      // Stores the last typed text
    let lastUiElement = null; // Stores the DOM element of the last text
    let isPaused = false;

    // --- 1. LOAD VOICES ---
    function loadVoices() {
        voices = synth.getVoices();
        if(voices.length > 0) {
            voiceSelect.innerHTML = '';
            // Sort English/Hindi to top
            voices.sort((a,b) => (a.lang.includes('IN') || a.lang.includes('en')) ? -1 : 1);
            
            voices.forEach((v, i) => {
                const opt = document.createElement('option');
                opt.value = i; // Store index
                opt.textContent = `${v.name.slice(0, 25)} (${v.lang})`;
                voiceSelect.appendChild(opt);
            });
        }
    }
    loadVoices();
    if(speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = loadVoices;

    // --- 2. SPEAK FUNCTION ---
    function speak(text, uiEl) {
        // Stop any current speech
        synth.cancel();
        isPaused = false;
        
        // Remove old highlights
        document.querySelectorAll('.active-reading').forEach(e => e.classList.remove('active-reading'));

        if(!text) return;

        const utter = new SpeechSynthesisUtterance(text);
        
        // Voice Selection logic
        const index = parseInt(voiceSelect.value);
        if(voices[index]) utter.voice = voices[index];

        // Highlight Events
        utter.onstart = () => {
            if(uiEl) {
                uiEl.classList.add('active-reading');
                uiEl.scrollIntoView({behavior: "smooth", block: "center"});
            }
        };
        
        utter.onend = () => {
            if(uiEl) uiEl.classList.remove('active-reading');
            isPaused = false;
        };

        synth.speak(utter);
    }

    // --- 3. INPUT HANDLER ---
    inputField.addEventListener('keydown', (e) => {
        if(e.key === 'Enter') {
            const text = inputField.value.trim();
            if(!text) return;

            // 1. Clear Console if you only want 1 message at a time? 
            // The prompt said "nothing else", but usually chat bots keep history.
            // If you want to CLEAR history every time, uncomment the next line:
            // outputDiv.innerHTML = ''; 

            // 2. Create UI Element
            const div = document.createElement('div');
            div.className = 'log-entry';
            div.textContent = text; // Pure text, no timestamp
            outputDiv.appendChild(div);
            
            // 3. Update State variables
            lastText = text;
            lastUiElement = div;

            // 4. Speak
            speak(text, div);

            // 5. Cleanup
            inputField.value = '';
            setTimeout(() => outputDiv.scrollTop = outputDiv.scrollHeight, 50);
            inputField.focus();
        }
    });

    // --- 4. BUTTONS ---
    
    // PLAY: Resume if paused, OR re-read last text if stopped
    document.getElementById('btn-play').onclick = () => {
        if (isPaused) {
            synth.resume();
            isPaused = false;
        } else if (!synth.speaking && lastText) {
            // Nothing is speaking, but we have text on screen -> Read it again
            speak(lastText, lastUiElement);
        }
    };

    // PAUSE: Standard pause
    document.getElementById('btn-pause').onclick = () => {
        if (synth.speaking && !synth.paused) {
            synth.pause();
            isPaused = true;
        }
    };

    // STOP: Cancel everything
    document.getElementById('btn-stop').onclick = () => {
        synth.cancel();
        isPaused = false;
        document.querySelectorAll('.active-reading').forEach(e => e.classList.remove('active-reading'));
    };

    // Resize fix
    window.addEventListener('resize', () => {
        outputDiv.scrollTop = outputDiv.scrollHeight;
    });

</script>
</body>
</html>