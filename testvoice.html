<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Android TTS Reader</title>

<style>
    body {
        font-family: system-ui, sans-serif;
        background: #0f172a;
        color: #e5e7eb;
        padding: 12px;
    }

    select, button {
        padding: 8px;
        margin: 4px 2px;
        border-radius: 6px;
        border: none;
        font-size: 14px;
    }

    button {
        cursor: pointer;
        background: #2563eb;
        color: white;
    }

    button:disabled {
        opacity: 0.5;
    }

    textarea {
        width: 100%;
        height: 55vh;
        margin-top: 10px;
        padding: 12px;
        font-size: 16px;
        line-height: 1.6;
        border-radius: 8px;
        background: #020617;
        color: #f8fafc;
        border: 1px solid #334155;
        resize: none;
        overflow-y: auto;
    }

    mark {
        background: #fde047;
        color: #000;
        padding: 0;
    }
</style>
</head>

<body>

<h3>Android Speech Synthesis Reader</h3>

<select id="languageSelect"></select>
<select id="voiceSelect"></select>

<br>

<button id="playBtn">▶ Play</button>
<button id="pauseBtn">⏸ Pause</button>
<button id="stopBtn">⏹ Stop</button>

<textarea id="consoleText" placeholder="Type or paste text here..."></textarea>

<script>
const synth = window.speechSynthesis;

const languageSelect = document.getElementById("languageSelect");
const voiceSelect = document.getElementById("voiceSelect");
const textArea = document.getElementById("consoleText");

let voices = [];
let utterance = null;
let startIndex = 0;
let isPaused = false;

// Load voices (Android needs delay)
function loadVoices() {
    voices = synth.getVoices();

    const languages = [...new Set(voices.map(v => v.lang))].sort();

    languageSelect.innerHTML = "";
    languages.forEach(lang => {
        const opt = document.createElement("option");
        opt.value = lang;
        opt.textContent = lang;
        languageSelect.appendChild(opt);
    });

    updateVoices();
}

function updateVoices() {
    const lang = languageSelect.value;
    voiceSelect.innerHTML = "";

    voices.filter(v => v.lang === lang).forEach(v => {
        const opt = document.createElement("option");
        opt.value = v.name;
        opt.textContent = v.name;
        voiceSelect.appendChild(opt);
    });
}

languageSelect.addEventListener("change", updateVoices);

speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

// Highlight helper
function highlightText(start, length) {
    const text = textArea.value;
    const before = text.substring(0, start);
    const word = text.substring(start, start + length);
    const after = text.substring(start + length);

    textArea.innerHTML = "";
    textArea.value = before + word + after;

    textArea.setSelectionRange(start, start + length);

    const lineHeight = 24;
    const lines = before.split("\n").length;
    textArea.scrollTop = (lines * lineHeight) - (textArea.clientHeight / 2);
}

// PLAY
document.getElementById("playBtn").onclick = () => {
    if (synth.speaking && isPaused) {
        synth.resume();
        isPaused = false;
        return;
    }

    synth.cancel();

    startIndex = textArea.selectionStart;
    const textToRead = textArea.value.substring(startIndex);
    if (!textToRead.trim()) return;

    utterance = new SpeechSynthesisUtterance(textToRead);

    const selectedVoice = voices.find(v => v.name === voiceSelect.value);
    if (selectedVoice) utterance.voice = selectedVoice;

    utterance.onboundary = (e) => {
        if (e.name === "word") {
            highlightText(startIndex + e.charIndex, e.charLength);
        }
    };

    utterance.onend = () => {
        isPaused = false;
    };

    synth.speak(utterance);
};

// PAUSE
document.getElementById("pauseBtn").onclick = () => {
    if (synth.speaking && !synth.paused) {
        synth.pause();
        isPaused = true;
    }
};

// STOP
document.getElementById("stopBtn").onclick = () => {
    synth.cancel();
    isPaused = false;
};
</script>

</body>
</html>
